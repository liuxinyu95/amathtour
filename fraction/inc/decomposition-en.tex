\section{Algorithm for best Egyptian decomposition}
\phantomsection
\label[appendix]{app:best-egyptian-decomposition}

Fibonacci's greedy method asserts any irreducible proper fraction $\dfrac{b}{a}$ can be decomposed into at most $b$ Egyptian fractions. The `best' decomposition should not contain more Egyptian fractions than $b$. If there are multiple ways with the same least decomposed fractions, then the less denominator the better. We maintain a set $B = \{\dfrac{1}{q_1}, \dfrac{1}{q_2}, \cdots \dfrac{1}{q_m} \}$ to record the best candidate of decomposition and initialize $B = \varnothing$. Below are the steps of the algorithm:

\begin{enumerate}[1)]
  \item Decompose $\dfrac{b}{a}$ into no more than $n = b$ Egyptian fractions. First, try to decompose $\dfrac{b}{a} = \dfrac{1}{q} + x$, where $q = \lfloor \dfrac{a}{b} \rfloor + 1$ is 1 plus the quotient of $a$ divided by $b$. This step is as same as Fibonacci's method.
  \item Simplify the problem to decompose $x$ into no more than $n - 1$ Egyptian fractions. We add $\dfrac{1}{q}$ to a set as $Q = \{\dfrac{1}{q}\}$. Next calculate $x = \dfrac{b}{a} - \dfrac{1}{q} = \dfrac{bq - a}{aq}$ and denote the result in the lowest terms as $\dfrac{b'}{a'}$ (apply Euclidean algorithm to find the greatest common divisor of the nominator and denominator, then reduce the fraction by it.).
  \item If $b' = 1$ and $a' > q$, then we find a \emph{candidate} decomposition. We restrict $a' > q$ because: if $\dfrac{b}{a} = \dfrac{1}{q_0} + \dfrac{1}{q_1} + \cdots + \dfrac{1}{q_m}$ is a solution where $\dfrac{1}{q_i} \in Q$, then any permutation of $\dfrac{1}{q_i}$ is also a solution. To avoid duplication, we restrict $\dfrac{1}{q_0} > \dfrac{1}{q_1} > \cdots > \dfrac{1}{q_m}$, otherwise we skip the duplicated solution. When find a new solution, we add $\dfrac{1}{a'}$ to $Q$, then compare $Q$ with $B$ for a better one. If $B = \varnothing$ or $|Q|<|B|$ (the new solution has fewer Egyptian fractions) or the maximum denominator in $Q$ is less than that in $B$, then we replace $B$ with $Q$, and then go on search.
  \item If $b' \ne 1$, we append $\dfrac{b'}{a'}$ together with $Q$ as a pair to the \emph{tail} of a list\footnote{Actually a queue in computer programming} $C$, such that we shall decompose $\dfrac{b'}{a'}$ on top of $Q$ in the future.
  \item We next increase $q$ by 1 as $q' = q + 1$, then attempt to decompose $\dfrac{b}{a} = \dfrac{1}{q'} + x$. Obviously, such decomposition isn't as greedy as Fibonacci's one with $q$; the remaining part $x$ is greater. Here we need examine if $n\dfrac{1}{q'} < \dfrac{b}{a}$, which means the sum of $n$ fractions $\leq \dfrac{1}{q'}$ can't reach $\dfrac{b}{a}$, hence it does not make sense to further decompose $x$. We stop and poll a pair from the \emph{head} of $C$; the pair contains $\dfrac{b'}{a'}$ and $Q$, from where we continue searching the best decomposition. Otherwise if $n\dfrac{1}{q'} \geq \dfrac{b}{a}$, we return to step 2), and continue try to decompose $x$ into no more than $n-1$ Egyptian fractions.
  \item We try every candidate from $q, q' = q + 1, q'' = q + 2 \cdots $ to $q + i \geq \dfrac{an}{b}$. Because the Egyptian fractions in $Q$ are descending (their denominators are ascending), the $x$ in $\dfrac{b}{a} = \dfrac{1}{q+i} + x$ can't be decomposed into $n-1$ Egyptian fractions being less than $\dfrac{1}{q+i}$.
  \item Every time, we poll a pair of $\dfrac{b'}{a'}$ and $Q$ from the head of $C$, if $Q$ isn't empty, we need: (a) Compare the denominator $q_0$ of the minimum fractions in $q = \lfloor \dfrac{a'}{b'} \rfloor + 1$ and $Q = \{\dfrac{1}{q_0}, \cdots \}$, and pick the greater one for further decomposition. (b) Compare $Q$ and $B$, if $B$ is not empty and contains fewer Egyptian fractions, then $Q$ can't be the best solution. Because we always append the candidates containing more fractions to the tail of $C$, the following ones must be worse, hence $B$ is the best and the algorithm terminates.
\end{enumerate}

Below is the formal description of the algorithm. The reader who knows computer programming may implement it.

\begin{algorithmic}[1]
\Function{Decompose}{$\dfrac{b}{a}$}
  \If{$b = 1$}
    \State \Return $\{\dfrac{1}{a}\}$
  \EndIf
  \State $n = b, B = \varnothing$
  \State $C = \{(\dfrac{b}{a}, \varnothing)\}$
  \While{$C \ne \varnothing$}
    \State $(\dfrac{b}{a}, Q) \gets $ \Call{Pop}{$C$}  \Comment{poll from the head of $C$}
    \State $n' = n - |Q|$                            \Comment{decompose at most $n'$ Egyptian fractions}
    \State $q = \lfloor \dfrac{a}{b} \rfloor + 1$
    \If {$\varnothing \ne Q = \{\dfrac{1}{q_0}, \cdots \}$ and $q_0 \geq q$}  \Comment{The first fraction in $Q$ is less.}
      \State $q = q_0 + 1$
    \EndIf
    \While{$q \leq \dfrac{an'}{b}$}
      \If{$B \ne \varnothing$ and $|Q| \geq |B| - 1$} \Comment{Candidates in $C$ are worse than $B$}
        \State \Return $B$
      \EndIf
      \State $\dfrac{b'}{a'} = $ \Call{Reduce}{$\dfrac{b}{a} - \dfrac{1}{q}$} \Comment{reduce to lowest terms}
      \If{$b' = 1$ and $a' > q$}
        \State compare $\{\dfrac{1}{a'}, \dfrac{1}{q}\} \cup Q$ and $B$, record the better as $B$
      \Else
        \State \Call{Push}{$(\dfrac{b'}{a'}, \{\dfrac{1}{q}\} \cup Q), C$} \Comment{Append to the tail of $C$}
      \EndIf
      \State $q \gets q + 1$
    \EndWhile
  \EndWhile
  \State \Return $B$
\EndFunction
\end{algorithmic}
